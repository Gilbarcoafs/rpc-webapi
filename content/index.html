<html>
<head title="rpc+ web api">
  <script src="knockout-3.2.0.js"></script>
  <script src="jquery-2.1.1.min.js"></script>
</head>

<body>

  <div>
  <h1>rpc+ web api</h1>
  the rpc+ webapi supports the following functions:
  <h3>gpio functions</h3>
  <ul>
  <li>gpio export</li>
  <li>gpio unexport</li>
  <li>gpio direction get</li>
  <li>gpio direction set</li>
  <li>gpio value get</li>
  <li>gpio value set</li>
  </ul>
  </div>

<!--  <div>
  <h4>examples</h4>
  <ul>
    <li>export gpio 3: <a href="gpio/export?gpio=3">gpio/export?gpio=3</a></li>
    <li>unexport gpio 3: <a href="gpio/unexport?gpio=3">gpio/unexport?gpio=3</a></li>
    <li>set gpio 3 direction out: <a href="gpio/direction/set?gpio=3&direction=out">gpio/direction/set?gpio=3&direction=out</a></li>
    <li>set gpio 3 direction in: <a href="gpio/direction/set?gpio=3&direction=in">gpio/direction/set?gpio=3&direction=in</a></li>
    <li>get gpio 3 value: <a href="gpio/value/get?gpio=3">gpio/value/get?gpio=3</a></li>
    <li>set gpio 3 value high: <a href="gpio/value/set?gpio=3&value=1">gpio/value/set?gpio=3&value=1</a></li>
    <li>set gpio 3 value low: <a href="gpio/value/set?gpio=3&value=0">gpio/value/set?gpio=3&value=0</a></li>
  </ul>
  </div>
-->
  <div id="gpio_api">
    <label>gpio</label>
    <input data-bind="value: gpio" />
    <div>
      <button data-bind="click: export_click()">export</button>
      <button data-bind="click: unexport_click()">unexport</button>
    </div>
    <div>
      <button data-bind="click: get_direction_click()">get direction</button>
      <label data-bind="text: direction"></label>
    </div>
    <div>
      <button data-bind="click: set_direction_click()">set direction</button>
      <select data-bind="options: direction_values, value: direction_new"></select>
    </div>
    <div>
      <button data-bind="click: get_value_click()">get value</button>
      <label data-bind="text: value"></label>
    </div>
    <div>
      <button data-bind="click: set_value_click()">set value</button>
      <select data-bind="options: output_values, value: value_new"></select>
    </div>
  </div>

  <script type="text/javascript">
  (function() {
    var vm = {
      gpio: ko.observable(2),
      direction: ko.observable(''),
      direction_new: ko.observable(''),
      direction_values: ko.observableArray( ['in', 'out']),
      value: ko.observable(''),
      value_new: ko.observable(''),
      output_values: ko.observableArray( ['low', 'high'] ),
      export_click: function () {
        $.ajax('/gpio/export?gpio=' + vm.gpio(), { async: true });
        vm.update();
      },
      unexport_click: function () {
        $.ajax('/gpio/unexport?gpio=' + vm.gpio(), {});
        vm.update();
      },
      get_direction_click: function () {
        $.ajax('/gpio/direction/get?gpio=' + vm.gpio(), { async: true, success: function (data) { vm.direction(data); } });
      },
      set_direction_click: function () {
        $.ajax('/gpio/direction/set?gpio=' + vm.gpio() + '&direction=' + vm.direction_new(), { async: false });
        vm.get_direction_click();
      },
      get_value_click: function () {
        $.ajax('/gpio/value/get?gpio=' + vm.gpio(), { async: true, success: function (data) { vm.value(data); } });
      },
      set_value_click: function () {
        var url = '/gpio/value/set?gpio=' + vm.gpio() + '&value=' + ((vm.value_new() === 'in') ? '0' : '1');
        $.ajax(url, { async: true });
        vm.get_value_click();
      },

      update: function () {
        vm.get_direction_click();
        vm.get_value_click();
      }
    };

    vm.gpio.subscribe(function (newValue) { vm.update(); });

    ko.applyBindings(vm, document.getElementById('gpio_api'));
  })();
  </script>

</body>
</html>